# Product Requirements Document (PRD): MASAE Delivery Tracker

## 1. Executive Summary
**Product Name:** MASAE Delivery Tracker
**Version:** 2.5 (Web)
**Description:** A specialized supply chain and site management platform for agricultural resource distribution in Senegal. It manages the full lifecycle from raw material excavation and screening to bagging (Production), regional allocation (Planning), and dispatch/delivery (Logistics). 

## 2. User Roles
*   **Administrator:** Full access to all modules, including financial overviews, system settings, and global network analysis.
*   **Manager (Site):** Focuses on operational modules: Production (Ensachage, Purchases, Excavation), Logistics (FIFO), and Route planning.
*   **Driver:** Limited access to the FIFO queue system via QR code scanning for site entry.

## 3. Functional Requirements

### 3.1 Dashboard & Analytics
*   **KPI Tracking:** Real-time metrics for Delivered vs. Target tonnage, Production Stock, Active Fleet, and Site Expenses.
*   **Regional Performance:** Visual comparisons of planning vs. realization per region.
*   **Logistics Flow Correlation:** A dual-axis chart correlating daily bagged production tonnage against daily dispatched delivery tonnage to monitor inventory health and efficiency.

### 3.2 Production Management (Module Suite)
This module is split into four specialized sub-areas to track the upstream supply chain:
*   **Ensachage (Bagging):**
    *   Daily tracking of "Sacs Déployés" (consumption) vs. "Sacs Ensachés" (50kg units).
    *   **Workforce Tracking:** Distinguishes between the general filling team (Nombre d'éléments) and the specialized sewing team (Equipe Couture).
    *   **Automated Labor Cost:** Calculated as: `(Filling Team + Sewing Team) × Daily Wage`.
    *   **UI:** Forms are organized into color-coded thematic sections (General, Workforce, Production Data).
*   **Achats & Dépenses (Site Expenses):**
    *   Granular tracking of inputs (bags, thread), site fuel, maintenance, and catering.
    *   Category-based filtering and statistical summaries.
*   **Cribblage (Screening):** Tracking of sifting operations and machine yields.
*   **Excavation:** Tracking of mining extraction volumes and raw stock levels.

### 3.3 Allocations (Planning)
*   Quotas management for operators across regions, departments, and communes.
*   Visual progress tracking via multi-step indicators.
*   Automated status transitions (Open -> In Progress -> Closed) based on delivered tonnage.

### 3.4 Logistics & FIFO
*   **FIFO Queue:** A QR-code-based arrival system to manage the order of trucks on-site.
*   **Dispatching:** Creating "Bons de Livraison" (BL) by linking trucks to open allocations.
*   **Notes de Frais:** Tracking shipment-specific costs like fuel, road tolls, and handling (manutention).

### 3.5 Intelligence & Reports
*   **Network Map:** Proportional node-graph visualization of the distribution hierarchy.
*   **Gemini Itinerary:** AI-powered route calculation between the central hub (Amadi Ounare) and any delivery point in Senegal.
*   **Professional BL Export:** Generation of branded PDF delivery notes with specific SOMA header and stamp designs.

## 4. Technical Specifications
*   **Frontend:** React 19, Tailwind CSS, Lucide, Recharts, Vis-network.
*   **Backend:** Supabase (PostgreSQL) with Row Level Security (RLS).
*   **Schema Additions:**
    *   `production`: Added `equipe_couture`.
    *   `production_purchases`: New table for site operational expenses.
*   **AI:** Google Gemini 2.5 Flash for geospatial logic.
